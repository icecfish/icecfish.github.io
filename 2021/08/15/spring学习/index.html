<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="java," />










<meta name="description" content="IOC控制反转、DI依赖注入">
<meta property="og:type" content="article">
<meta property="og:title" content="spring学习">
<meta property="og:url" content="http://icecfish.github.io/2021/08/15/spring%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="Icefish">
<meta property="og:description" content="IOC控制反转、DI依赖注入">
<meta property="og:locale">
<meta property="og:image" content="http://icecfish.github.io/.io//spring%E5%AD%A6%E4%B9%A0%5Cimage-20210910184322772.png">
<meta property="og:image" content="http://icecfish.github.io/.io//blog/public/img/ssm-img/image-20210910163600951.png">
<meta property="og:image" content="http://icecfish.github.io/.io//blog/public/img/ssm-img/image-20210910171228862.png">
<meta property="og:image" content="http://icecfish.github.io/.io//blog/public/img/ssm-img/image-20210910172506491.png">
<meta property="article:published_time" content="2021-08-14T16:00:00.000Z">
<meta property="article:modified_time" content="2021-09-10T13:42:36.379Z">
<meta property="article:author" content="Zcb">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://icecfish.github.io/.io//spring%E5%AD%A6%E4%B9%A0%5Cimage-20210910184322772.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://icecfish.github.io/2021/08/15/spring学习/"/>





  <title>spring学习 | Icefish</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Icefish</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://icecfish.github.io/2021/08/15/spring%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/18cc395b668d48888eaca3a0cceec50a_th.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icefish">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">spring学习</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-08-15T00:00:00+08:00">
                2021-08-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="IOC控制反转、DI依赖注入"><a href="#IOC控制反转、DI依赖注入" class="headerlink" title="IOC控制反转、DI依赖注入"></a>IOC控制反转、DI依赖注入</h1><span id="more"></span>

<p>Spring基础知识学习笔记(一)，内容包括： </p>
<ol>
<li>Spring入门案例 </li>
<li>IOC控制反转理解</li>
<li>属性注入的不同方式 </li>
<li>注入不同类型的属性值 </li>
<li>自动装配与注解开发</li>
</ol>
<h2 id="1-Spring概述"><a href="#1-Spring概述" class="headerlink" title="1. Spring概述"></a>1. Spring概述</h2><p>开源的免费框架，是一个容器，可以管理所有的组件(类)；</p>
<p> 轻量级的、非入侵的框架，不依赖于Spring的API</p>
<p> 控制反转(IOC)和面向切面编程(AOP) 支持事务处理，支持对框架整合 组件化、一站式 </p>
<p>官网： <a target="_blank" rel="noopener" href="https://spring.io/">https://spring.io</a> </p>
<p>文档：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.2.5.RELEASE/spring-framework-reference/core.html#s">https://docs.spring.io/spring/docs/5.2.5.RELEASE/spring-framework-reference/core.html#s</a> pring-core </p>
<p>【总结】：Spring是一个轻量级的、控制反转和面向切面编程的框架</p>
<p>体系结构：</p>
<p><img src="/.io//spring%E5%AD%A6%E4%B9%A0%5Cimage-20210910184322772.png" alt="image-20210910184322772"></p>
<p>Test：Spring的单元测试模块 </p>
<p>Core Container：核心容器(IOC)，包括4部分： </p>
<p>​    spring-core：提供了框架的基本组成部分，包括 IoC 和依赖注入功能。 </p>
<p>​    spring-beans：提供 BeanFactory， </p>
<p>​    spring-context：模块建立在由core和 beans 模块的基础上建立起来的，它以一种类似于 JNDI注册的方式访问对象。Context模块继承自Bean模块，并且添加了国际化（比如，使用 资源束）、事件传播、资源加载和透明地创建上下文（比如，通过Servelet容器）等功能 </p>
<p>​    spring-expression：提供了强大的表达式语言，用于在运行时查    询和操作对象图。它是 JSP2.1规范中定义的统一表达式语言的扩展，支持set和get属性值、属性赋值、方法调用、访 问数组集合    及索引的内容、逻辑算术运算、命名变量、通过名字从SpringIoC容器检索对 象，还支持列表的投影、选择以及聚合等 </p>
<p>AOP+Aspects：面向切面编程模块 </p>
<p>Data Access：数据访问模块 </p>
<p>Web：Spring开发Web引用模块</p>
<p>导入依赖：spring-webmvc 包含的最广泛</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="2-HelloWorld案例"><a href="#2-HelloWorld案例" class="headerlink" title="2.HelloWorld案例"></a>2.HelloWorld案例</h2><h3 id="2-1IOC和DI"><a href="#2-1IOC和DI" class="headerlink" title="2.1IOC和DI"></a>2.1IOC和DI</h3><p><strong>Inversion of Control：控制反转。</strong></p>
<p> 控制，即资源的获取方式，包括： </p>
<p>主动式：要什么资源自己创建，对于复杂对象的创建时比较庞大的工程 </p>
<p>被动式：资源的获取不是我们自己创建，而是交给容器创建。 所谓容器，是用来管理所有的组件的(即有功能的类)；容器可以自动探查出哪些组件需要用到另一 些组件</p>
<p> <strong>DI：Dependency Injection，依赖注入</strong>，是IOC的一种实现形式。容器能知道哪个组件运行时需要另 外一个类，容器通过反射的形式，将容器中准备好的对象注入。</p>
<h3 id="2-2入门案例"><a href="#2-2入门案例" class="headerlink" title="2.2入门案例"></a>2.2入门案例</h3><p>HelloWorld：所有的对象交给容器创建，给容器中注册组件 </p>
<ol>
<li>新建一个Person类，<strong>添加set方法</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String lastName, Integer age, String gender, String email)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lastName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String lastName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">            <span class="string">&quot;lastName=&#x27;&quot;</span> + lastName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">            <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">            <span class="string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">            <span class="string">&quot;, email=&#x27;&quot;</span> + email + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.新建一个Spring配置文件ApplicationContext.xml，注册bean。<br>   使用 bean 标签注册一个Person对象，Spring会自动创建这个Person对象<br>   class：写要注册的组件的全类名<br>   id：这个对象的唯一标识<br>   使用 property 标签为Person对象的属性值，name：指定属性名；value：指定属性值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册一个Person对象，Spring会自动创建这个Person对象</span></span><br><span class="line"><span class="comment">class:写要注册的组件的全类名</span></span><br><span class="line"><span class="comment">id:这个对象的唯一标识</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用property标签为Person对象的属性赋值</span></span><br><span class="line"><span class="comment">name:指定属性名</span></span><br><span class="line"><span class="comment">value:指定属性值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan@163.com&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IocTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ApplicationContext ioc = <span class="keyword">new</span></span><br><span class="line">            ClassPathXmlApplicationContext(<span class="string">&quot;ApplicationContext.xml&quot;</span>);</span><br><span class="line">        Person bean = (Person) ioc.getBean(<span class="string">&quot;person01&quot;</span>);</span><br><span class="line">        System.out.println(bean);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>【几个细节】： </p>
<ol>
<li>ApplicationContext：IOC容器的接口 </li>
<li> 同一个组件在IOC容器中默认是单实例的 </li>
<li>容器中的对象的创建在容器创建完成的时候就已经创建好了</li>
<li> 容器中如果没有这个组件，获取组件时会报异常 NoSuchBeanDefinitionException </li>
<li>IOC容器用 property 标签创建这个组件对象的时候，会利用setter方法为其属性赋值，注意 属性名是set方法后的那串的首字母小写</li>
</ol>
<h3 id="2-3-根据bean类型获取bean实例"><a href="#2-3-根据bean类型获取bean实例" class="headerlink" title="2.3 根据bean类型获取bean实例"></a>2.3 根据bean类型获取bean实例</h3><p>ioc.getBean()方法中可以传入bean的id，也可以传入class对象，也可以同时传入。 </p>
<p>如果一个类型指只注册了一个，则可以通过 ioc.getBean(….class) 获得该对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person bean1 = ioc.getBean(Person.class);</span><br></pre></td></tr></table></figure>

<p>但是如果IOC容器中这个类型的bean有多个，则会报异常 NoUniqueBeanDefinitionException</p>
<p>也可以同时传入bean的id和class对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person bean1 = ioc.getBean(<span class="string">&quot;person02&quot;</span>,Person.class);</span><br></pre></td></tr></table></figure>

<h2 id="3-属性的注入方式"><a href="#3-属性的注入方式" class="headerlink" title="3.属性的注入方式"></a>3.属性的注入方式</h2><ul>
<li>依赖：bean对象的创建依赖于容器 </li>
<li>注入：bean对象中所有的属性由容器来注入</li>
</ul>
<h3 id="3-1-setter注入"><a href="#3-1-setter注入" class="headerlink" title="3.1 setter注入"></a>3.1 setter注入</h3><p><strong>需要借助set方法</strong>，使用 propetry 标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-通过构造器注入"><a href="#3-2-通过构造器注入" class="headerlink" title="3.2 通过构造器注入"></a>3.2 通过构造器注入</h3><p>使用 <code>constructor-arg</code> 标签，则调用构造器进行属性注入，<strong>需要借助有参构造</strong></p>
<ul>
<li><strong>通过构造函数中的参数名称注入</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;wangwu&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>只写value属性</strong>，<strong>会默认按顺序寻找构造方法进行匹配</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;wangwu&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>通过构造函数参数类型</strong>，默认按照顺序</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">value</span>=<span class="string">&quot;wangwu&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>通过构造函数参数索引</strong>，如果有多个重载的构造函数时也可以配合type一起使用</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;wangwu&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-p名称空间注入"><a href="#3-3-p名称空间注入" class="headerlink" title="3.3 p名称空间注入"></a>3.3 p名称空间注入</h3><p>使用p:propertyName直接注入属性的值。本质上还是调用的set方法 </p>
<p>导入头文件约束：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">1</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan@163.com&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person04&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:lastName</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">p:age</span>=<span class="string">&quot;30&quot;</span> <span class="attr">p:email</span>=<span class="string">&quot;zhangsan@qq.com&quot;</span> <span class="attr">p:gender</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-4-c命名空间注入"><a href="#3-4-c命名空间注入" class="headerlink" title="3.4 c命名空间注入"></a>3.4 c命名空间注入</h3><p>c(构造: Constructor)命名空间注入，使用c:propertyName注入属性值,本质上使用的是构造器注入 </p>
<p>导入头文件约束：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xmlns:c=&quot;http://www.springframework.org/schema/c&quot;</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person05&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">c:lastName</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">c:age</span>=<span class="string">&quot;30&quot;</span> <span class="attr">c:email</span>=<span class="string">&quot;zhangsan@qq.com&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">c:gender</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-注入不同类型的属性值"><a href="#4-注入不同类型的属性值" class="headerlink" title="4.注入不同类型的属性值"></a>4.注入不同类型的属性值</h2><p>新建了一个Student类和一个Address类，来测试不同类型的属性值注入：</p>
<p> Student类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="keyword">private</span> String[] books;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hobbys;</span><br><span class="line">    <span class="keyword">private</span> Map card;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; games;</span><br><span class="line">    <span class="keyword">private</span> String wife;</span><br><span class="line">    <span class="keyword">private</span> Properties info;</span><br><span class="line">    <span class="comment">//get/set方法</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Address类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line">    <span class="comment">//get/set方法</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-1-注入基本类型值"><a href="#4-1-注入基本类型值" class="headerlink" title="4.1 注入基本类型值"></a>4.1 注入基本类型值</h3><p>之前的例子都是注入基本类型的属性。如果不赋值的话，会使用属性的默认值 </p>
<h3 id="4-2-注入null"><a href="#4-2-注入null" class="headerlink" title="4.2 注入null"></a>4.2 注入null</h3><p> 如果有属性给了初始值，想注入为null，则在property内部需要使用 null 标签：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意，使用value=”null”是不对的：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;null&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的用法虽然对象的name属性打印出来是null，但是bean.getName()==null是false.(相当于给string类型赋值“null”)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Student bean = ioc.getBean(<span class="string">&quot;student01&quot;</span>, Student.class);</span><br><span class="line">System.out.println(bean);</span><br><span class="line">System.out.println(bean.getName()==<span class="keyword">null</span>); <span class="comment">//false																			</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student&#123;name=&#x27;null&#x27;, address=null, books=null, hobbys=null, card=null,games=null, false&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-注入bean"><a href="#4-3-注入bean" class="headerlink" title="4.3 注入bean"></a>4.3 注入bean</h3><p>可以使用 ref 引用外部的值：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--先注册一个Address对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;address01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Address&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;num&quot;</span> <span class="attr">value</span>=<span class="string">&quot;001&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student02&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过id值引用--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;address01&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>要注意，<strong>ref是严格的引用</strong>，通过容器拿到的Address实例就是Student实例中的Address属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Address address01 = ioc.getBean(<span class="string">&quot;address01&quot;</span>, Address.class);</span><br><span class="line">Student student02 = ioc.getBean(<span class="string">&quot;student02&quot;</span>, Student.class);</span><br><span class="line">System.out.println(student02);</span><br><span class="line">System.out.println(student02.getAddress() == address01); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p>也可以引用<strong>内部bean</strong>，在 property 标签体中再定义bean，这个Address和外面的没有关系，<strong>只能内部使用</strong>，外面获取不到：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student03&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Address&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tianijng&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;num&quot;</span> <span class="attr">value</span>=<span class="string">&quot;002&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-集合类型赋值"><a href="#4-3-集合类型赋值" class="headerlink" title="4.3 集合类型赋值"></a>4.3 集合类型赋值</h3><h4 id="01-数组"><a href="#01-数组" class="headerlink" title="01 数组"></a>01 数组</h4><p>array 标签+ value 标签：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;books&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>西游记<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>红楼梦<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>水浒传<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="02-List"><a href="#02-List" class="headerlink" title="02 List"></a>02 List</h4><p>list 标签+ value 标签：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hobbys&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>玩游戏<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>看电影<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="03-Map"><a href="#03-Map" class="headerlink" title="03 Map"></a>03 Map</h4><p>props 标签：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;学号&quot;</span>&gt;</span>20190604<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;性别&quot;</span>&gt;</span>男<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;姓名&quot;</span>&gt;</span>小明<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="05-util名称空间"><a href="#05-util名称空间" class="headerlink" title="05 util名称空间"></a>05 util名称空间</h4><p>util名称空间可以创建集合类型的bean，以便别的地方引用。 </p>
<p>头文件约束：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">xmlns:util=&quot;http://www.springframework.org/schema/util&quot;</span><br><span class="line">xsi:schemaLocation= &quot;http://www.springframework.org/schema/util</span><br><span class="line">http://www.springframework.org/schema/util/spring-util-4.1.xsd&quot;</span><br><span class="line"><span class="comment">&lt;!--util名称空间 提取出通用的集合--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;myList&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>玩游戏<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>看电影<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用ref直接引用util提取出来的集合id即可--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student05&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hobbys&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;myList&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-级联属性赋值"><a href="#4-4-级联属性赋值" class="headerlink" title="4.4 级联属性赋值"></a>4.4 级联属性赋值</h3><p>propetry 标签中的name标签，可以使用级联属性，修改属性的属性，但是原来属性的值会被修改。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;address01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Address&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;num&quot;</span> <span class="attr">value</span>=<span class="string">&quot;001&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student02&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;address01&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--将address01中的num属性进行了修改--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address.num&quot;</span> <span class="attr">value</span>=<span class="string">&quot;00005&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-继承实现配置信息重用"><a href="#4-5-继承实现配置信息重用" class="headerlink" title="4.5 继承实现配置信息重用"></a>4.5 继承实现配置信息重用</h3><p>指定parent属性为要重用的bean的id值，不写的属性就沿用，也可以重写定义属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan@163.com&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--parent：要重用的配置信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person001&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;person01&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--单独修改name属性的值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhang&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>还可以指定属性abstract=“true”，这样的bean只能被用来继承信息，不能获取实例。否则会报异常 BeanIsAbstractException</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用property标签为Person对象的属性赋值</span></span><br><span class="line"><span class="comment">name:指定属性名</span></span><br><span class="line"><span class="comment">value:指定属性值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan@163.com&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-bean的一些性质"><a href="#5-bean的一些性质" class="headerlink" title="5.bean的一些性质"></a>5.bean的一些性质</h2><h3 id="5-1-bean之间依赖"><a href="#5-1-bean之间依赖" class="headerlink" title="5.1 bean之间依赖"></a>5.1 bean之间依赖</h3><p>多个bean的默认创建顺序，是按照配置顺序创建的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Student&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;address&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Address&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.bean.Person&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">Student创建了</span><br><span class="line">Address创建了</span><br><span class="line">Person创建了</span><br></pre></td></tr></table></figure>

<p>可以用depends-on属性进行设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;student&quot; class=&quot;com.xiao.bean.Student&quot; depends-on=&quot;person,address&quot;&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=&quot;address&quot; class=&quot;com.xiao.bean.Address&quot;&gt;&lt;/bean&gt;</span><br><span class="line">&lt;bean id=&quot;person&quot; class=&quot;com.xiao.bean.Person&quot;&gt;&lt;/bean&gt;</span><br><span class="line">Person创建了</span><br><span class="line">Address创建了</span><br><span class="line">Student创建了</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-2-bean的作用域scope"><a href="#5-2-bean的作用域scope" class="headerlink" title="5.2 bean的作用域scope"></a>5.2 bean的作用域scope</h3><p>在bean配置中可以设置作用域属性scope：</p>
<ul>
<li>single： 单例模式，是默认模式。在容器启动完成之前就已经创建好对象保存在容器中了。 </li>
<li>prototype ：原型模式，容器启动会不去创建，每次从容器中get的时候才会产生一个新对象</li>
<li>request：在web环境下，同一次请求创建一个bean实例(没用) </li>
<li>session：在web环境下，同一次会话创建一个bean实例(没用)</li>
</ul>
<h3 id="5-3-静态工厂与实例工厂"><a href="#5-3-静态工厂与实例工厂" class="headerlink" title="5.3 静态工厂与实例工厂"></a>5.3 静态工厂与实例工厂</h3><p>静态工厂：工厂本身不用创建对象，通过静态方法调用，对象 = 工厂类.工厂方法名( ) </p>
<p>实例工厂：工厂本身需要创建对象，先创建工厂对象，再通过工厂对象创建所需对象 </p>
<p>新建三个类Air、AirStaticFactory和AirInstanceFactory：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Air</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line">    <span class="keyword">private</span> Double length;</span><br><span class="line">    <span class="keyword">private</span> Integer PersonNum;</span><br><span class="line">    <span class="comment">//get/set...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AirStaticFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//提供一个静态方法获取Air对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Air <span class="title">getAir</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AirStaticFactory正在造飞机！&quot;</span>);</span><br><span class="line">        Air air = <span class="keyword">new</span> Air();</span><br><span class="line">        air.setName(name);</span><br><span class="line">        air.setLength(<span class="number">100.0</span>);</span><br><span class="line">        air.setWeight(<span class="number">100.0</span>);</span><br><span class="line">        air.setPersonNum(<span class="number">200</span>);</span><br><span class="line">        <span class="keyword">return</span> air;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AirInstanceFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//提供一个方法获取Air对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Air <span class="title">getAir</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AirInstanceFactory正在造飞机！&quot;</span>);</span><br><span class="line">        Air air = <span class="keyword">new</span> Air();</span><br><span class="line">        air.setName(name);</span><br><span class="line">        air.setLength(<span class="number">100.0</span>);</span><br><span class="line">        air.setWeight(<span class="number">100.0</span>);</span><br><span class="line">        air.setPersonNum(<span class="number">200</span>);</span><br><span class="line">        <span class="keyword">return</span> air;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态工厂：不需要创建工厂本身，class指定静态工厂的全类名，factory-method指定工厂方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--静态工厂，不需要创建工厂本身,class指定静态工厂的全类名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;air01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.AirStaticFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getAir&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;林青霞&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">//获取到的就是Air的实例</span><br><span class="line">Air air01 = ioc.getBean(&quot;air01&quot;,Air.class);</span><br></pre></td></tr></table></figure>

<p>实例工厂：先创建示例工厂本身，再创建对象，指定当前对象的创建需要哪个工厂factory-bean和哪个 方法factory-method</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--实例工厂，需要先创建示例工厂本身--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;airInstanceFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.AirInstanceFactory&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--指定当前对象的创建需要哪个工厂和哪个方法，不需要指定class了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;air02&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;airInstanceFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getAir&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张学友&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">Air air02 = ioc.getBean(&quot;air02&quot;,Air.class);</span><br></pre></td></tr></table></figure>

<h3 id="5-4-自定义工厂"><a href="#5-4-自定义工厂" class="headerlink" title="5.4 自定义工厂"></a>5.4 自定义工厂</h3><p>实现了FactoryBean接口的类，是Spring可以认识的工厂类，Spring会自动调用工厂方法创建对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFactoryBeanImpl</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Air</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//工厂方法，Spring会自动调用这个方法来创建对象并返回</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Air <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Air air = <span class="keyword">new</span> Air();</span><br><span class="line">        air.setName(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> air;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回对象的类型,Spring会自动调用这个方法来确认创建的对象是什么类型</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Air.class;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//是单例模式吗？</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注册工厂对象，会自动调用工厂方法返回对象：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注册工厂对象，会自动调用工厂方法返回对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;air03&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.MyFactoryBeanImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">Air air03 = ioc.getBean(&quot;air03&quot;);</span><br></pre></td></tr></table></figure>

<p>这种类型，IOC容器启动时不会创建实例，使用getBean时才会创建</p>
<h3 id="5-5-bean的生命周期方法"><a href="#5-5-bean的生命周期方法" class="headerlink" title="5.5 bean的生命周期方法"></a>5.5 bean的生命周期方法</h3><p>可以为bean自定义一些生命周期方法，Spring在创建或销毁bean时调用。 init-method ， destroymethod ，不能有参数。 </p>
<p>IOC容器中注册的bean：</p>
<ul>
<li>单实例bean：容器启动的时候就会创建好，容器关闭也会销毁创建的bean (容器启动)构造器 —&gt; 初始化方法 —&gt; （容器关闭)销毁方法 </li>
<li>多实例bean：获取的时候才去创建 (容器启动)构造器 —&gt; 初始化方法 ，容器关闭不会调用bean的销毁方法</li>
</ul>
<p>在Air类中新增两个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Air</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line">    <span class="keyword">private</span> Double length;</span><br><span class="line">    <span class="keyword">private</span> Integer PersonNum;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;销毁方法被调用了！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始方法被调用了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;bean id=<span class="string">&quot;air04&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.xiao.Air&quot;</span> init-method=<span class="string">&quot;init&quot;</span> destroymethod=<span class="string">&quot;destroy&quot;</span>&gt; &lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-6-bean的后置处理器"><a href="#5-6-bean的后置处理器" class="headerlink" title="5.6 bean的后置处理器"></a>5.6 bean的后置处理器</h3><p>定义一个类实现BeanPostProcessor接口，其中两个方法 postProcessBeforeInitialization 和 postProcessAfterInitialization 会在调用初始化方法前后调用。需要注册这个实现类 </p>
<p>即使没有定义初始化方法，这两个方法也会被调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 前置处理器，在初始化方法之前调用</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> bean 传递过来的，将要初始化的bean</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 经该方法处理之后可以返回一个新的bean</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span><span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【&quot;</span>+beanName+<span class="string">&quot;】将要调用初始化方法了..BeforeInitialization..这个bean是这样的：+【&quot;</span>+bean+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">                           <span class="comment">/**</span></span><br><span class="line"><span class="comment">* 后置处理器，在初始化方法之后调用</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 经该方法处理后返回给IOC容器保存的bean</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span><span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【&quot;</span>+beanName+<span class="string">&quot;】初始化方法调用完了..AfterInitialization..这个bean是这样的：+【&quot;</span>+bean+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;bean id=<span class="string">&quot;air04&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.xiao.Air&quot;</span> init-method=<span class="string">&quot;init&quot;</span> destroymethod=<span class="string">&quot;destroy&quot;</span>&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;myBeanPostProcessor&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.xiao.MyBeanPostProcessor&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">【air04】将要调用初始化方法了..BeforeInitialization..这个bean是这样的：+</span><br><span class="line">【Air&#123;name=&#x27;null&#x27;, weight=null, length=null, PersonNum=null&#125;】</span><br><span class="line">初始方法被调用了</span><br><span class="line">【air04】初始化方法调用完了..AfterInitialization..这个bean是这样的：+</span><br><span class="line">【Air&#123;name=&#x27;null&#x27;, weight=null, length=null, PersonNum=null&#125;】</span><br></pre></td></tr></table></figure>

<h2 id="6-bean的装配"><a href="#6-bean的装配" class="headerlink" title="6.bean的装配"></a>6.bean的装配</h2><h3 id="6-1-Spring管理连接池"><a href="#6-1-Spring管理连接池" class="headerlink" title="6.1 Spring管理连接池"></a>6.1 Spring管理连接池</h3><p>配置C3P0的数据库连接池，注册一个ComboPooledDataSource对象即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-2-引入外部配置文件"><a href="#6-2-引入外部配置文件" class="headerlink" title="6.2 引入外部配置文件"></a>6.2 引入外部配置文件</h3><p>首先新建一个数据库连接池的配置文件db.properties：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.cj。jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql:///mybatis?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p>需要用到context命名空间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">xsi:schemaLocation=&quot;</span><br><span class="line">http://www.springframework.org/schema/context</span><br><span class="line">https://www.springframework.org/schema/context/spring-context.xsd&quot;</span><br></pre></td></tr></table></figure>

<p>使用 context:property-placeholder location=” … “ 标签导入数据库配置文件db.properties， 就可以用$取出对应的属性了：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>【一个小坑】：Spring内部已经定义过一个username了，${username}就是系统的用户名，所以这里 定义的是jdbc.username</p>
<h3 id="6-3-基于XML的自动装配"><a href="#6-3-基于XML的自动装配" class="headerlink" title="6.3 基于XML的自动装配"></a>6.3 基于XML的自动装配</h3><p>自动装配是Spring满足bean依赖的一种方式。Spring会在上下文中自动寻找，并给bean自动装配属性。 </p>
<p>Spring中的三种装配方式： </p>
<ol>
<li>在xml显示配置 </li>
<li> 在Java中显示配置</li>
<li> 隐式的自动装配bean</li>
</ol>
<p>在 bean 标签中设置 autowire 属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;air05&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.Air&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>autowire=”default/no” ：不自动装配 </li>
<li>autowire=”byName” ：按照名字，以属性名作为id去容器中找到这个组件，为其赋值；如果找不到就装配null </li>
<li>autowire=”byType” ：按照类型，以属性的类型作为查找依据去容器中找到这个组件，为其赋 值，<strong>该类型必须只有一个</strong>，否则会报异常NoUniqueBeanDifinetionException；如果找不到就装 配null </li>
<li>autowire=”construction” ：按照构造器进行赋值：先按照有参构造器的参数类型进行装，如果 没有就直接为组件装配null即可；如果按照类型有多个，就会把参数名作为id继续匹配，匹配到就 自动装配，匹配不到就装配null。不会报错</li>
</ul>
<h2 id="7-注解开发"><a href="#7-注解开发" class="headerlink" title="7.注解开发"></a>7.注解开发</h2><p>7.1 不同层组件 </p>
<p>1.通过给bean上添加注解，可以快速的将bean加入到IOC容器中。创建Dao、Service、Controller 层所需要用到的注解：</p>
<ul>
<li>@Component ：组件，放在类上，将某个类注册到Spring中，id是类名首字母小写。相当于：</li>
<li>@Repository ：Dao持久化层 </li>
<li>@Servic ：Service业务逻辑层 </li>
<li>@Controller ：Controller控制器层。后面三个含义更清晰 </li>
</ul>
<p>2.还需要告诉Spring，自动扫描加了注解的组件：添加context名称空间，``。还需要有AOP包的依 赖。 </p>
<p>3.组件的id默认是类名首字母小写，作用于默认是单例，可以修改。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(value = &quot;book&quot;)</span></span><br><span class="line"><span class="meta">@Scope(value = &quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveBook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;保存图书！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>@Value ：注入值，注入基本数据类型和String类型数据 </li>
<li>@Scope ：标注作用域。singleton, prototype… 细节：如果注解中有且只有一个属性要赋值时，且名称是value，value在赋值是可以不写。</li>
</ul>
<h3 id="7-2-context扫描包的配置"><a href="#7-2-context扫描包的配置" class="headerlink" title="7.2 context扫描包的配置"></a>7.2 context扫描包的配置</h3><p>指定要扫描的包：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xiao&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>指定扫描包时指定排除一些不要的组件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xiao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定排除不要的组件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;...&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;...&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>type=”annotation” ：按照注解进行排除， expression 属性中指定要排除的注解的全类名 </li>
<li>type=”assignable” ：按照类名进行排除， expression 属性中指定要排除的类的全类名 </li>
</ul>
<p>只扫描进入指定的组件，默认都是全部扫描进来， use-default-filters 需要设置为false：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xiao&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;...&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;...&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="7-3-Autowired自动装配"><a href="#7-3-Autowired自动装配" class="headerlink" title="7.3 Autowired自动装配"></a>7.3 Autowired自动装配</h3><h4 id="01-基本使用"><a href="#01-基本使用" class="headerlink" title="01 基本使用"></a>01 基本使用</h4><p>直接在成员上添加 @Autowired 完成自动装配。 </p>
<p>Dao层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">//声明一个方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readBook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;读了一本书！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service层，使用注解 @Autowired 完成成员BookDao的自动装配，调用dao层的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//使用@Autowired完成成员BookDao的自动装配</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookDao.readBook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller层，使用注解 @Autowired 完成成员BookService的自动装配，调用service层的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">one</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookService.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="02-Autowired的执行流程"><a href="#02-Autowired的执行流程" class="headerlink" title="02 Autowired的执行流程"></a>02 Autowired的执行流程</h4><p>@Autowired 可以直接用在属性上，执行流程：</p>
<ol>
<li>首先按照类型去容器中找对应的组件，如果找到一个就赋值，找不到就抛异常；</li>
<li>如果有多个类型匹配时，会使用要注入的对象变量名称作为bean的id，在spring容器查找，找到 了也可以注入成功，找不到就报错。</li>
<li>结合注解 @Qualifer ，指定一个id：在自动按照类型注入的基础之上，再按照指定的bean的id去 查找。它在给字段注入时不能独立使用，必须和@Autowired 一起使用；但是给方法参数注入时， 可以独立使用。 </li>
</ol>
<p>@Autowired 标注的属性如果找不到就会报错，可以指定required属性，找不到就自动装配null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired(required = false )</span></span><br></pre></td></tr></table></figure>

<h4 id="03-注解加在方法上"><a href="#03-注解加在方法上" class="headerlink" title="03 注解加在方法上"></a>03 注解加在方法上</h4><p>@Autowired ：也可以使用在set方法上，执行流程跟上面一样； </p>
<p>@Qualifer ：还可以用在方法的参数，指定按照哪个id去装配。 </p>
<p>@Nullable ：标记的属性可以null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setBookDao</span><span class="params">(BookDao bookDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookDao.readBook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Resource： 直接按照Bean的id注入，是Java自带的注解。执行流程：</p>
<ol>
<li><p>如果同时指定了name和type，则从Spring上下文中找到唯一匹配的bean进行装配，找不到则抛 出异常</p>
</li>
<li><p>如果指定了name，则从上下文中查找id匹配的bean进行装配，找不到则抛出异常 </p>
</li>
<li><p>如果指定了type，则从上下文中找到类型匹配的唯一bean进行装配，找不到或者找到多个，都会 抛出异常</p>
</li>
<li><p>如果既没有指定name，又没有指定type，则自动按照byName方式（类名首字母小写比如 BookDao-&gt;bookDao）进行装配；如果没有匹配，则回退为一个原始类型进行匹配，如果匹配则 自动装配；</p>
</li>
</ol>
<h3 id="7-4-Spring的单元测试"><a href="#7-4-Spring的单元测试" class="headerlink" title="7.4 Spring的单元测试"></a>7.4 Spring的单元测试</h3><p>使用Spring的单元测试，不需要用ioc.getBean()来获取组件了，直接Autowired组件，Spring自动装配 导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Junit--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加注解： </p>
<ul>
<li>@ContextConfiguration：指定Spring配置文件的位置</li>
<li>@RunWith：指定用哪种驱动进行单元测试，默认是junit，这里指定用Spring的单元测试模块来执 行标了@Test注解的测试方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*@ContextConfiguration:指定Spring配置文件的位置</span></span><br><span class="line"><span class="comment">*@RunWith：指定用哪种驱动进行单元测试，默认是junit,这里指定用Spring的单元测试模块来执行标了</span></span><br><span class="line"><span class="comment">@Test注解的测试方法</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:ApplicationContext.xml&quot;)</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test02</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookController bookController;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookController.one();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Autowired好处：不用ioc.getBean();获取组件了，直接Autowired组件为我们自动装配</p>
<p><img src="/.io//blog\public\img\ssm-img\image-20210910163600951.png" alt="image-20210910163600951"></p>
<h1 id="动态代理、AOP"><a href="#动态代理、AOP" class="headerlink" title="动态代理、AOP"></a>动态代理、AOP</h1><p>Spring基础知识学习笔记(二)，内容包括： </p>
<ol>
<li>代理模式：静态代理和动态代理 </li>
<li> AOP实现：注解实现+配置文件实现 </li>
<li>切面、通知、切入点、切入点表达式 </li>
<li>环绕通知 </li>
</ol>
<p>OOP：(Object Oriented Programming) 面向对象编程。 </p>
<p>AOP：(Aspect Oriented Programming) 面向切面编程，基于OOP基础之上的编程思想，在程序运行期间，将某段代码动态的切入到指定方法的指定位置进行运算。 </p>
<p>应用场景：计算器运行计算方法的时候进行日志记录，不推荐直接在方法内部，修改维护麻烦。</p>
<h2 id="1-代理模式"><a href="#1-代理模式" class="headerlink" title="1. 代理模式"></a>1. 代理模式</h2><h3 id="1-1-静态代理"><a href="#1-1-静态代理" class="headerlink" title="1.1 静态代理"></a>1.1 静态代理</h3><p>静态代理角色分析：</p>
<p>抽象角色 : 一般使用接口或者抽象类来实现 </p>
<p>真实角色 : 被代理的角色 </p>
<p>代理角色 : 代理真实角色 ; 代理真实角色后 , 一般会做一些附属的操作 . </p>
<p>客户 : 使用代理角色来进行一些操作 </p>
<p>案例：房东有房子，交给中介代理，客户直接找中介，中介在租房前后带客户看房子和收中介费。 </p>
<p>租房接口Renet：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//抽象角色：租房接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Rent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>真实角色房东：Host，实现了Rent接口，可以出租房子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//真实角色: 房东，房东要出租房子</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Host</span> <span class="keyword">implements</span> <span class="title">Rent</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;房屋出租&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代理角色Proxy：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Rent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Host host;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">(Host host)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//中介在出租房屋前带客户看房子</span></span><br><span class="line">        seeHouse();</span><br><span class="line">        <span class="keyword">this</span>.host.rent();</span><br><span class="line">        <span class="comment">//中介在出租房屋后收中介费</span></span><br><span class="line">        fare();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">seeHouse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;带客户看房子&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收中介费&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户Client，找中介租房：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//房东</span></span><br><span class="line">        Host host = <span class="keyword">new</span> Host();</span><br><span class="line">        <span class="comment">//中介来代理房东</span></span><br><span class="line">        Proxy proxy = <span class="keyword">new</span> Proxy(host);</span><br><span class="line">        <span class="comment">//客户找中介，中介出租房屋</span></span><br><span class="line">        proxy.rent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">带客户看房子</span><br><span class="line">房屋出租！</span><br><span class="line">收中介费</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>

<p><strong>静态代理的好处:</strong> </p>
<ul>
<li>使得真实角色更加纯粹，不再去关注一些公共的事情 </li>
<li>公共的业务由代理来完成，实现了业务的分工 </li>
<li>公共业务发生扩展时变得更加集中和方便 </li>
</ul>
<p><strong>缺点 :</strong></p>
<ul>
<li>类多了 , 多了代理类 , 工作量变大了 ，开发效率降低</li>
</ul>
<h3 id="1-2-动态代理"><a href="#1-2-动态代理" class="headerlink" title="1.2 动态代理"></a>1.2 动态代理</h3><p>动态代理的角色和静态代理的一样 ，区别是动态代理的代理类是动态生成的 ，静态代理的代理类是提前写好的。 </p>
<p>动态代理分为两类 : 一类是基于接口动态代理 , 一类是基于类的动态代理 </p>
<ul>
<li>基于接口的动态代理—-JDK动态代理，代理对象和被代理对象唯一能产生的关联就是实现了同一个 接口。如果目标对象没有实现任何接口，是无法为其创建代理对象的。 </li>
<li>基于类的动态代理–cglib </li>
</ul>
<p>JDK动态代理需要两个核心类：<strong>Proxy</strong>代理和<strong>InvocationHandler</strong>调用处理程序。 </p>
<p><strong>Proxy：</strong> </p>
<p>Proxy.newProxyInstance() 方法为目标对象创建代理对象，返回代理对象。三个参数： </p>
<ul>
<li>ClassLoader loader：和被代理对象使用相同的类加载器。 </li>
<li>Class[] interfaces：和被代理对象具有相同的行为。实现相同的接口。</li>
<li>InvocationHandler：如何代理，方法执行器。 </li>
</ul>
<p><strong>InvocationHandler：</strong> </p>
<p>调用其 invoke() 方法，执行被代理对象的任何方法，都会经过该方法，三个参数：被代理对象、方法、参数 </p>
<ul>
<li>Object proxy：被代理的对象 </li>
<li>Method method：方法</li>
<li>Object[] args：执行方法的参数 </li>
</ul>
<p>代码实现： </p>
<ol>
<li>定义一个出租房子的接口Rent</li>
<li> 房东类实现Rent，具有出租房子的功能</li>
<li>定义一个类实现InvocationHandler接口，来创建动态代理对象，增强功能 </li>
<li>动态代理对象调用方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"><span class="doctag">@Description</span>: 定义一个类实现InvocationHandler接口，来创建动态代理对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Rent rent;</span><br><span class="line">    <span class="comment">//设置要代理的接口</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRent</span><span class="params">(Rent rent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rent = rent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//声明一个生成代理类的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Proxy.newProxyInstance()传入三个参数：类加载器，类实现的接口，InvocationHandler对象</span></span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(<span class="keyword">this</span>.getClass().getClassLoader(),rent.getClass().getInterfaces(), <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//处理实例，并返回结果</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Rent rent,Rent.class.getDeclaredMethod(<span class="string">&quot;rent&quot;</span>)</span>,Object[] args)</span>&#123;</span><br><span class="line">        <span class="comment">//先看房</span></span><br><span class="line">        seeHouse();</span><br><span class="line">        <span class="comment">//使用反射机制invoke方法，传入被代理的接口和参数。使用真实对象的方法</span></span><br><span class="line">        Object result = method.invoke(rent, args);</span><br><span class="line">        fare();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">seeHouse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;中介带看房子&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fare</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;中介收费&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>:测试类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//真实角色</span></span><br><span class="line">        Host host = <span class="keyword">new</span> Host();</span><br><span class="line">        ProxyInvocationHandler proxyInvocationHandler = <span class="keyword">new</span></span><br><span class="line">            ProxyInvocationHandler();</span><br><span class="line">        <span class="comment">//传入要代理的接口</span></span><br><span class="line">        proxyInvocationHandler.setRent(host);</span><br><span class="line">        <span class="comment">//获得代理对象</span></span><br><span class="line">        Rent proxy = (Rent) proxyInvocationHandler.getProxy();</span><br><span class="line">        <span class="comment">//代理对象使用真实对象的方法，方法被增强了</span></span><br><span class="line">        proxy.rentHouse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-动态代理实现日志功能"><a href="#1-3-动态代理实现日志功能" class="headerlink" title="1.3 动态代理实现日志功能"></a>1.3 动态代理实现日志功能</h3><ol>
<li>定义一个Calculator接口，声明加减乘除方法</li>
<li>定义一个MyCalculator类实现Calculator接口，完成方法体 </li>
<li>定义一个生成代理对象的类CalculatorProxy，获取代理对象</li>
<li> 重写InvocationHandler的invoke方法，在执行目标方法前后，添加相应的日志输出，也可以处理 异常信息 </li>
</ol>
<p>Calculator接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="comment">//加减乘除方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>MyCalculator类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCalculator</span> <span class="keyword">implements</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i + j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i - j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">multiply</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i * j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">divide</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i / j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>日志工具类LogUtils：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">//执行前</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method,Object... args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【&quot;</span>+method.getName()+<span class="string">&quot;】方法开始执行了，用的参数列表是【&quot;</span>+Arrays.asList(args)+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行后</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">(Method method,Object result)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【&quot;</span>+method.getName()+<span class="string">&quot;】方法执行完成了，计算结果是【&quot;</span>+result+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//出现异常</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exception</span><span class="params">(Method method,Exception e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【&quot;</span>+method.getName()+<span class="string">&quot;】方法出现异常了,异常信息是：&quot;</span>+e.getCause());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//方法结束</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">(Method method)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【&quot;</span>+method.getName()+<span class="string">&quot;】方法最终结束了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成代理对象的类CalculatorProxy：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorProxy</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">* Proxy.newProxyInstance()</span></span><br><span class="line"><span class="comment">* 为传入的参数对象创建一个动态代理对象</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> calculator 被代理的对象</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Calculator <span class="title">getProxy</span><span class="params">(Calculator calculator)</span> </span>&#123;</span><br><span class="line">        Object proxy = Proxy.newProxyInstance(</span><br><span class="line">            calculator.getClass().getClassLoader(),</span><br><span class="line">            calculator.getClass().getInterfaces(),</span><br><span class="line">            <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> proxy 代理对象，给JDK使用的</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> method 当前将要执行的目标对象的方法</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> args 参数</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                    Object result = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">//目标方法执行前</span></span><br><span class="line">                        LogUtils.before(method,args);</span><br><span class="line">                        System.out.println(<span class="string">&quot;动态代理要帮你执行方法！&quot;</span>);</span><br><span class="line">                        <span class="comment">//利用反射执行目标方法</span></span><br><span class="line">                        result = method.invoke(calculator, args);</span><br><span class="line">                        <span class="comment">//目标方法执行后</span></span><br><span class="line">                        LogUtils.after(method,result);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="comment">//目标方法出现异常</span></span><br><span class="line">                        LogUtils.exception(method,e);</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        <span class="comment">//目标方法结束后</span></span><br><span class="line">                        LogUtils.end(method);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//返回值必须返回出去，外界才能拿到真正执行后的返回值</span></span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="comment">//返回代理对象</span></span><br><span class="line">        <span class="keyword">return</span> (Calculator) proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Calculator calculator = <span class="keyword">new</span> MyCalculator();</span><br><span class="line">        Calculator proxy = CalculatorProxy.getProxy(calculator);</span><br><span class="line">        proxy.add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        proxy.divide(<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">【add】方法开始执行了，用的参数列表是【[<span class="number">1</span>, <span class="number">2</span>]】</span><br><span class="line">动态代理要帮你执行方法！</span><br><span class="line">【add】方法执行完成了，计算结果是【<span class="number">3</span>】</span><br><span class="line">【add】方法最终结束了</span><br><span class="line">【divide】方法开始执行了，用的参数列表是【[<span class="number">2</span>, <span class="number">0</span>]】</span><br><span class="line">动态代理要帮你执行方法！</span><br><span class="line">【divide】方法出现异常了,异常信息是：java.lang.ArithmeticException: / by zero</span><br><span class="line">【divide】方法最终结束了</span><br></pre></td></tr></table></figure>

<h2 id="2-aop"><a href="#2-aop" class="headerlink" title="2.aop"></a>2.aop</h2><p>AOP：(Aspect Oriented Programming) 面向切面编程，将某段代码动态的切入到指定方法的指定位置 (方法的开始、结束、异常…)。 </p>
<p>使用场景： </p>
<ul>
<li>加日志保存到数据库 </li>
<li>做权限验证 </li>
<li>做安全检查 </li>
<li>做事务控制</li>
</ul>
<h3 id="2-1-几个专业术语"><a href="#2-1-几个专业术语" class="headerlink" title="2.1 几个专业术语"></a>2.1 几个专业术语</h3><p><img src="/.io//blog\public\img\ssm-img\image-20210910171228862.png" alt="image-20210910171228862"></p>
<ul>
<li>横切关注点：与业务逻辑无关的，但是需要关注的部分，就是横切关注点，方法的开始、返回、异常、结束等。 </li>
<li>切面（ASPECT）类：在上面例子中相当于自己定义的一个日志工具类。 </li>
<li>通知（Advice）：切面必须要完成的工作，是类中的一个方法。 </li>
<li>目标（Target）：被通知对象。</li>
<li>代理（Proxy）：向目标对象应用通知之后创建的对象。</li>
<li>连接点（JointPoint）：每一个方法的每一个位置都是一个连接点 </li>
<li>切入点（PointCut）：切面通知执行的 “地点”，即真正需要执行日志记录的地方 </li>
<li>切入点表达式：在众多连接点中选出我们感兴趣的地方</li>
</ul>
<h3 id="2-2-注解实现步骤"><a href="#2-2-注解实现步骤" class="headerlink" title="2.2 注解实现步骤"></a>2.2 注解实现步骤</h3><p>需要AOP织入，要导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>步骤： </p>
<ol>
<li>将目标类和切面类(封装了通知方法的类)加入到IOC容器中，注解 @Component ，配置文件开启 context:component-scan包扫描</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.chenhui&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>告诉Spring到底哪个是切面类，在类上注解 @Aspect</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtils</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>告诉Spring切面中的方都是何时何地运行，方法上注解</p>
</li>
<li><p>在注解中写切入点表达式：execution(访问权限符 返回值类型 方法全类名(参数表))</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">//执行前</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*</span></span><br><span class="line"><span class="meta">            (int,int))&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法开始执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行后</span></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*</span></span><br><span class="line"><span class="meta">                    (int,int))&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行完成了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//出现异常</span></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*</span></span><br><span class="line"><span class="meta">                   (int,int))&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exception</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法出现异常了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//方法结束</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*</span></span><br><span class="line"><span class="meta">           (int,int))&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法最终结束了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>@Before：在目标方法之前运行；前置通知 </li>
<li>@After：在目标方法之后运行；后置通知 </li>
<li>@AfterReturning：在目标方法正常返回之后；返回通知 </li>
<li>@AfterThrowing：在目标方法抛出异常之后；异常通知 </li>
<li>@Around：环绕通知</li>
</ul>
<ol start="5">
<li>配置文件中开启基于注解的AOP功能 AOP名称空间头文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/aop</span><br><span class="line">https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启注解支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码实现： </p>
<p>目标类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCalculator</span> <span class="keyword">implements</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>切面类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">//执行前</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*(int,int))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法开始执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行后</span></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*</span></span><br><span class="line"><span class="meta">                    (int,int))&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行完成了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//出现异常</span></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*</span></span><br><span class="line"><span class="meta">                   (int,int))&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exception</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法出现异常了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//方法结束</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*(int,int))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法最终结束了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试，获取到目标对象的bean，执行方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopTest</span> </span>&#123;</span><br><span class="line">    ApplicationContext ioc = <span class="keyword">new</span></span><br><span class="line">        ClassPathXmlApplicationContext(<span class="string">&quot;ApplicationContext.xml&quot;</span>);</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//注意这里是根据接口类型获取的</span></span><br><span class="line">        Calculator bean = ioc.getBean(Calculator.class);</span><br><span class="line">        System.out.println(bean);<span class="comment">//com.xiao.MyProxy02.MyCalculator@3c9bfddc</span></span><br><span class="line">        System.out.println(bean.getClass());<span class="comment">//class com.sun.proxy.$Proxy22</span></span><br><span class="line">        bean.add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xiao.MyProxy02&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启注解支持--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-注解实现的几个细节"><a href="#2-3-注解实现的几个细节" class="headerlink" title="2.3 注解实现的几个细节"></a>2.3 注解实现的几个细节</h3><h4 id="01-获取组件"><a href="#01-获取组件" class="headerlink" title="01 获取组件"></a>01 获取组件</h4><p>IOC容器中保存的是组件的代理对象。ioc.getBean()中使用的接口类型，也可以用id名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Calculator bean = ioc.getBean(Calculator.class);</span><br><span class="line">System.out.println(bean);<span class="comment">//com.xiao.MyProxy02.MyCalculator@3c9bfddc</span></span><br><span class="line">System.out.println(bean.getClass());<span class="comment">//class com.sun.proxy.$Proxy22</span></span><br></pre></td></tr></table></figure>

<h4 id="02-cglib"><a href="#02-cglib" class="headerlink" title="02 cglib"></a>02 cglib</h4><p>有一个proxy-target-class属性，默认为false，表示使用jdk动态代理织入增强，当配为 true 时，表示 使用CGLib动态代理技术织入增强。不过即使proxy-target-class设置为false，如果目标类没有声明接 口，则spring将自动使用CGLib动态代理。 </p>
<p>cglib可以为没有实现接口的组件创建代理对象，通过本类类型或者id名获取到：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">xiao</span>.<span class="title">MyProxy02</span>.<span class="title">MyCalculator</span>$$<span class="title">EnhancerBySpringCGLIB</span>$$5<span class="title">ef61d8e</span></span></span><br></pre></td></tr></table></figure>

<h4 id="03-切入点表达式的写法"><a href="#03-切入点表达式的写法" class="headerlink" title="03 切入点表达式的写法"></a>03 切入点表达式的写法</h4><p> 固定格式：**execution(访问权限符 返回值类型 方法全类名(参数表))**，表达式中支持 &amp;&amp; 、||、 ！ </p>
<p>“execution(* <em>.</em>(..))” ：表示任意返回值类型，任意包下的任意类的任意方法，任意参个数 </p>
<p>通配符： </p>
<ul>
<li>*可以匹配一个或多个字符；匹配一个参数；匹配一层路径；权限位置不写就行 </li>
<li>.. 匹配任意多个参数，任意类型参数，任意多层路径 </li>
</ul>
<h4 id="04-通知方法的执行顺序"><a href="#04-通知方法的执行顺序" class="headerlink" title="04 通知方法的执行顺序"></a>04 通知方法的执行顺序</h4><p>正常执行：Before →方法执行 →After → AfterReturning(正常返回) </p>
<p>出现异常：Before →方法执行 →After → AfterThrowing</p>
<h4 id="05-拿到目标方法的详细信息"><a href="#05-拿到目标方法的详细信息" class="headerlink" title="05 拿到目标方法的详细信息"></a>05 拿到目标方法的详细信息</h4><p>从JoinPoint对象中可以拿到方法的详细信息，joinPoint.getArgs()，joinPoint.getSignature() </p>
<p>也可以接收异常和返回值，需要自己传入对应的参数Object result、Exception exception，并且要告诉 Spring指定返回值returning ，指定异常throwing</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行前</span></span><br><span class="line"><span class="meta">@Before(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*(int,int))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【&quot;</span>+ joinPoint.getSignature().getName()+<span class="string">&quot;】方法开始执行了，用的参数列表是【&quot;</span>+ Arrays.asList(joinPoint.getArgs())+<span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行后</span></span><br><span class="line"><span class="meta">@AfterReturning(value = &quot;execution(public int</span></span><br><span class="line"><span class="meta">                com.xiao.MyProxy02.MyCalculator.*(int,int))&quot;,returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">(JoinPoint joinPoint,Object result)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【&quot;</span>+ joinPoint.getSignature().getName()+<span class="string">&quot;】方法执行完成了，执行结果是【&quot;</span>+ result +<span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//出现异常</span></span><br><span class="line"><span class="meta">@AfterThrowing(value = &quot;execution(public int</span></span><br><span class="line"><span class="meta">               com.xiao.MyProxy02.MyCalculator.*(int,int))&quot;,throwing =&quot;exception&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exception</span><span class="params">(JoinPoint joinPoint,Exception exception)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【&quot;</span>+joinPoint.getSignature().getName()+<span class="string">&quot;】方法出现异常了,异常信息是：&quot;</span>+exception);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//方法结束</span></span><br><span class="line"><span class="meta">@After(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*(int,int))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;【&quot;</span>+joinPoint.getSignature().getName()+<span class="string">&quot;】方法最终结束了&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="06-抽取可重用的切入点表达式"><a href="#06-抽取可重用的切入点表达式" class="headerlink" title="06 抽取可重用的切入点表达式"></a>06 抽取可重用的切入点表达式</h4><p>自定义一个没有返回值和参数的方法，加上 @Pointcut 注解，声明切入点表达式，别的地方可以直接 使用其方法名进行引用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(public int com.xiao.MyProxy02.MyCalculator.*(int,int))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">myPoint</span><span class="params">()</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行前</span></span><br><span class="line"><span class="meta">@Before(&quot;myPoint()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="07-环绕通知"><a href="#07-环绕通知" class="headerlink" title="07 环绕通知"></a>07 环绕通知</h4><p>@Around ：就是利用反射调用目标方法，可以在其中定义环绕前置、环绕返回、环绕异常和环绕后置通知。环绕通知是优先于普通通知执行的。 </p>
<p>环绕通知只作用在自己的切面内。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;myPoint()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint point)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="comment">//获取参数</span></span><br><span class="line">    Object[] args = point.getArgs();</span><br><span class="line">    <span class="comment">//获取方法名</span></span><br><span class="line">    String name = point.getSignature().getName();</span><br><span class="line">    Object proceed = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// @Before</span></span><br><span class="line">        System.out.println(<span class="string">&quot;【环绕前置通知】..【&quot;</span> + name + <span class="string">&quot;】方法开始，用的参数列表是&quot;</span></span><br><span class="line">                           + Arrays.asList(args));</span><br><span class="line">        <span class="comment">//就是利用反射调用目标方法，类似于method.invoke(obj,args)</span></span><br><span class="line">        proceed = point.proceed(args);</span><br><span class="line">        <span class="comment">// @AfterReturning</span></span><br><span class="line">        System.out.println(<span class="string">&quot;【环绕返回通知】..【&quot;</span> + name + <span class="string">&quot;】方法返回，返回值是&quot;</span> +</span><br><span class="line">                           proceed);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// @AfterThrowing</span></span><br><span class="line">        System.out.println(<span class="string">&quot;【环绕异常通知】..【&quot;</span> + name + <span class="string">&quot;】方法出现异常，异常信息是&quot;</span></span><br><span class="line">                           + e);</span><br><span class="line">        <span class="comment">//为了让外界知道这个异常，将其抛出</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// @After</span></span><br><span class="line">        System.out.println(<span class="string">&quot;【环绕后置通知】..【&quot;</span> + name + <span class="string">&quot;】方法结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//反射调用后的返回值也一定返回出去</span></span><br><span class="line">    <span class="keyword">return</span> proceed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">【环绕前置通知】..【add】方法开始，用的参数列表是[1, 2]</span><br><span class="line">【add】方法开始执行了，用的参数列表是【[1, 2]】</span><br><span class="line">【环绕返回通知】..【add】方法返回，返回值是3</span><br><span class="line">【环绕后置通知】..【add】方法结束</span><br><span class="line">【add】方法最终结束了</span><br><span class="line">【add】方法执行完成了，执行结果是【3】</span><br></pre></td></tr></table></figure>

<p>执行顺序：</p>
<p> (环绕前置 —&gt; 普通前置) —&gt; 目标方法执行 —&gt; 环绕正常返回/出现异常 —&gt; 环绕后置 —&gt; 普通后置 —&gt; 普通返回或者异常</p>
<h4 id="08-多切面情况"><a href="#08-多切面情况" class="headerlink" title="08 多切面情况"></a>08 多切面情况</h4><p>执行顺序按照类名顺序，前置1–&gt;前置2–&gt;目标方法 –&gt;后置2–&gt;后置1</p>
<p><img src="/.io//blog\public\img\ssm-img\image-20210910172506491.png" alt="image-20210910172506491"></p>
<p>在切面上使用 @Order 注解，给一个int值，值越小，优先级越高</p>
<h5 id="2-4-配置文件实现"><a href="#2-4-配置文件实现" class="headerlink" title="2.4 配置文件实现"></a>2.4 配置文件实现</h5><p>在容器中注册bean，相当于 @component </p>
<p>进行配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aop:aspect ref=&quot;logUtils&quot;：`指定谁是切面类，相当于`@Aspect</span><br></pre></td></tr></table></figure>

<p>指定切入点和切入表达式</p>
<p>aop:before/after/after-returning/after-throwing：指定怎么切入，切在哪里，相当于 @Before等，该标签中也可以指定返回值、异常等信息。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注册bean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;logUtils&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.MyProxy02.LogUtils&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myCalculator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xiao.MyProxy02.MyCalculator&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--自定义切面aspect，ref:要引用的类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;logUtils&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--切入点--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;point&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(public int</span></span></span><br><span class="line"><span class="string"><span class="tag">                                             com.xiao.MyProxy02.MyCalculator.*(int,int))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--前置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;point&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--返回--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;after&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;point&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">returning</span>=<span class="string">&quot;result&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--异常--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;exception&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;point&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">throwing</span>=<span class="string">&quot;exception&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--后置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;end&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;point&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="声明式事务"><a href="#声明式事务" class="headerlink" title="声明式事务"></a>声明式事务</h1><p>Spring的声明式事务，内容包括： </p>
<ol>
<li>注解实现声明式事务 </li>
<li>事务的隔离级别 </li>
<li>事务的传播行为 </li>
<li> 配置文件实现 </li>
</ol>
<h2 id="1-环境搭建"><a href="#1-环境搭建" class="headerlink" title="1. 环境搭建"></a>1. 环境搭建</h2><h3 id="1-1-数据库环境"><a href="#1-1-数据库环境" class="headerlink" title="1.1 数据库环境"></a>1.1 数据库环境</h3><p>三张表：账户表account，书籍价格表，书籍库存表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE account (</span><br><span class="line">    username VARCHAR(50) PRIMARY KEY,</span><br><span class="line">    balance INT(10) NOT NULL</span><br><span class="line">)ENGINE=INNODB DEFAULT CHARSET=utf8;</span><br><span class="line">INSERT INTO account VALUES</span><br><span class="line">(&quot;Tom&quot;,1000),</span><br><span class="line">(&quot;Jerry&quot;,1000);</span><br><span class="line">CREATE TABLE book (</span><br><span class="line">    isbn VARCHAR(50) PRIMARY KEY,</span><br><span class="line">    book_name VARCHAR(50) NOT NULL,</span><br><span class="line">    price INT(10)</span><br><span class="line">)ENGINE = INNODB DEFAULT CHARSET=utf8;</span><br><span class="line">INSERT INTO book VALUES</span><br><span class="line">(&quot;ISBN-001&quot;,&quot;book01&quot;,100),</span><br><span class="line">(&quot;ISBN-002&quot;,&quot;book02&quot;,200),</span><br><span class="line">(&quot;ISBN-003&quot;,&quot;book03&quot;,300),</span><br><span class="line">(&quot;ISBN-004&quot;,&quot;book04&quot;,400),</span><br><span class="line">(&quot;ISBN-005&quot;,&quot;book05&quot;,500);</span><br><span class="line">CREATE TABLE book_stock (</span><br><span class="line">    isbn VARCHAR(50) PRIMARY KEY,</span><br><span class="line">    stock INT(10) NOT NULL</span><br><span class="line">)ENGINE= INNODB DEFAULT CHARSET = utf8;</span><br><span class="line">INSERT INTO book_stock VALUES</span><br><span class="line">(&quot;ISBN-001&quot;,10),</span><br><span class="line">(&quot;ISBN-002&quot;,10),</span><br><span class="line">(&quot;ISBN-003&quot;,10),</span><br><span class="line">(&quot;ISBN-004&quot;,10),</span><br><span class="line">(&quot;ISBN-005&quot;,10);</span><br></pre></td></tr></table></figure>

<h3 id="1-2-减余额、减库存的方法"><a href="#1-2-减余额、减库存的方法" class="headerlink" title="1.2 减余额、减库存的方法"></a>1.2 减余额、减库存的方法</h3><ol>
<li>新建一个BookDao类，用于操作数据库，包括减账户余额、减图书库存方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="comment">//减去某个用户的账户余额</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateBalance</span><span class="params">(String userName,<span class="keyword">int</span> price)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;UPDATE account SET balance = balance - ? WHERE username =</span></span><br><span class="line"><span class="string">            ?&quot;</span>;</span><br><span class="line">            <span class="keyword">this</span>.jdbcTemplate.update(sql,price,userName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//按照图书的isbn获取图书的价格</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getPrice</span><span class="params">(String isbn)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;SELECT price FROM book WHERE isbn = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.jdbcTemplate.queryForObject(sql,Integer.class,isbn);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//减去图书的库存,每次减去1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateStock</span><span class="params">(String isbn)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;UPDATE book_stock SET stock = stock-1 WHERE isbn = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>.jdbcTemplate.update(sql,isbn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>新建一个BookService类，结账方法，调用减账户余额和减图书库存两个方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">    <span class="comment">//结账方法，分为减库存，减余额两步操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkOut</span><span class="params">(String username,String isbn)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.减库存</span></span><br><span class="line">        <span class="keyword">this</span>.bookDao.updateStock(isbn);</span><br><span class="line">        System.out.println(<span class="string">&quot;减库存完成！&quot;</span>);</span><br><span class="line">        <span class="comment">//故意引入异常</span></span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//根据isbn查询价格</span></span><br><span class="line">        Integer price = <span class="keyword">this</span>.bookDao.getPrice(isbn);</span><br><span class="line">        <span class="comment">//2.减账户余额</span></span><br><span class="line">        <span class="keyword">this</span>.bookDao.updateBalance(username,price);</span><br><span class="line">        System.out.println(<span class="string">&quot;结账完成!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>数据库配置文件db.properties和Spring配置文件applicationContext.xml：</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/spring?</span></span><br><span class="line"><span class="attr">useSSL</span>=<span class="string">false&amp;useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xiao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入数据库配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据库连接信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册jdbcTemplate，传入一个数据源即可--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>测试</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Transaction</span> </span>&#123;</span><br><span class="line">    ApplicationContext ioc = <span class="keyword">new</span></span><br><span class="line">        ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BookService bookService = ioc.getBean(BookService.class);</span><br><span class="line">        bookService.checkOut(<span class="string">&quot;Tom&quot;</span>,<span class="string">&quot;ISBN-001&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果在减账户余额和减图书库存之间故意插入异常，则只会执行减余额操作，减库存未执行。</p>
<h2 id="2-声明式事务"><a href="#2-声明式事务" class="headerlink" title="2. 声明式事务"></a>2. 声明式事务</h2><h3 id="2-1-事务的ACID原则"><a href="#2-1-事务的ACID原则" class="headerlink" title="2.1 事务的ACID原则"></a>2.1 事务的ACID原则</h3><ul>
<li>原子性（Atomicity）： 事务是最小的执行单位，不允许分割。事务的原子性确保动作要么全部 完成，要么完全不起作用； </li>
<li>一致性（Consistency）： 执行事务前后，数据保持一致，多个事务对同一个数据读取的结果是 相同的； </li>
<li>隔离性（Isolation）： 并发访问数据库时，一个用户的事务不被其他事务所干扰，各并发事务之 间数据库是独立的； </li>
<li>持久性（Durability）： 一个事务被提交之后。它对数据库中数据的改变是持久的，即使数据库 发生故障也不应该对其有任何影响。 </li>
</ul>
<h3 id="2-2-声明式事务配置"><a href="#2-2-声明式事务配置" class="headerlink" title="2.2 声明式事务配置"></a>2.2 声明式事务配置</h3><p>Spring提供了事务管理器，就可以在目标方法运行前后进行事务控制(事务切面)。这里使用 DataSourceTransaction。 </p>
<p>步骤： </p>
<ol>
<li>配置事务管理器让其进行事务控制，传入要控制哪个数据源 </li>
<li>开启基于注解的事务控制，依赖于tx名称空间，指定事务管理器的id </li>
<li>给事务方法加注解 @Transactional</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:t</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xiao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入数据库配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据库连接信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册jdbcTemplate，传入一个数据源即可--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理器(切面)，DataSourceTransactionManager--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--要控制哪个数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启基于注解的事务控制模式，指定事务管理器的id--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>方法上加上注解 @Transactional</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkOut</span><span class="params">(String username,String isbn)</span> </span>&#123;</span><br><span class="line"><span class="comment">//....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-事务细节"><a href="#3-事务细节" class="headerlink" title="3. 事务细节"></a>3. 事务细节</h2><ul>
<li>Isolation isolation() ：事务的隔离级别，默认为 Isolation.DEFAULT Propagation </li>
<li>propagation() ：事务的传播行为，默认为Propagation.REQUIRED </li>
<li>Class[] rollbackFor() ：哪些异常事务需要回滚，让本来不回滚的异常进行回滚 </li>
<li>String[] rollbackForClassName() ： </li>
<li>Class[] noRollbackFor() ：哪些异常事务可以不回滚，让本来回滚的异常不回滚 </li>
<li>String[] noRollbackForClassName() </li>
<li>int timeout() ：事务超出指定执行时长后自动终止并回滚，单位为秒 </li>
<li>boolean readOnly() ：设置事务为只读事务，加快查询速度，不用管事务那一堆操作。默认为 false 3.1 超时/只读</li>
</ul>
<h3 id="3-1-超时-只读"><a href="#3-1-超时-只读" class="headerlink" title="3.1 超时/只读"></a>3.1 超时/只读</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(timeout = 3,readOnly = false)</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-rollbackFor-noRollbackFor"><a href="#3-2-rollbackFor-noRollbackFor" class="headerlink" title="3.2 rollbackFor/noRollbackFor"></a>3.2 rollbackFor/noRollbackFor</h3><p>运行时异常（非检查异常）：可以不用处理，默认都回滚 </p>
<p>编译时异常（检查异常）：要么try-catch，要么在方法上声明throws，默认不回滚 </p>
<ul>
<li>Class[] rollbackFor() ：哪些异常事务需要回滚，让本来不回滚的异常进行回滚 </li>
<li>Class[] noRollbackFor() ：哪些异常事务可以不回滚，让本来回滚的异常不回滚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(noRollbackFor = &#123;ArithmeticException.class&#125;)</span></span><br></pre></td></tr></table></figure>

<p>算术运算异常，是运行时异常，本来默认回滚的，设置noRollbackFor属性后，就不回滚了。</p>
<h3 id="3-3-事务的隔离级别"><a href="#3-3-事务的隔离级别" class="headerlink" title="3.3 事务的隔离级别"></a>3.3 事务的隔离级别</h3><h4 id="01-事务并发运行带来的问题"><a href="#01-事务并发运行带来的问题" class="headerlink" title="01 事务并发运行带来的问题"></a>01 事务并发运行带来的问题</h4><p>多个事务并发运行，经常会操作相同的数据来完成各自的任务，能会导致以下的问题： </p>
<ul>
<li><strong>脏读（Dirty read):</strong> 当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到 数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提 交的数据，那么另外一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确 的。 </li>
<li><strong>不可重复读（Unrepeatableread）:</strong> 指在一个事务内多次读同一数据。在这个事务还没有结束 时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改 导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样 的情况，因此称为不可重复读。 </li>
<li><strong>幻读（Phantom read）:</strong> 幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接 着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了 一些原本不存在的记录，就好像发生了幻觉一样，所以称为幻读。 </li>
</ul>
<h4 id="02-SQL的隔离级别"><a href="#02-SQL的隔离级别" class="headerlink" title="02 SQL的隔离级别"></a>02 SQL的隔离级别</h4><p>SQL 标准定义了四个隔离级别： </p>
<ul>
<li><strong>READ-UNCOMMITTED(读取未提交)：</strong> 最低的隔离级别，允许读取尚未提交的数据变更，可能会 导致脏读、幻读或不可重复读。 </li>
<li><strong>READ-COMMITTED(读取已提交)：</strong> 允许读取并发事务已经提交的数据，可以阻止脏读，但是幻 读或不可重复读仍有可能发生。 </li>
<li><strong>REPEATABLE-READ(可重复读)：</strong> 对同一字段的多次读取结果都是一致的，除非数据是被本身事务 自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生。MySQL的InnoDB 存储引擎默认的。 </li>
<li><strong>SERIALIZABLE(可串行化)：</strong> 最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执 行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读。 </li>
</ul>
<h4 id="03-Spring事务的隔离级别"><a href="#03-Spring事务的隔离级别" class="headerlink" title="03 Spring事务的隔离级别"></a>03 Spring事务的隔离级别</h4><p>TransactionDefinition 接口中定义了五个表示隔离级别的常量： </p>
<ul>
<li><strong>TransactionDefinition.ISOLATION_DEFAULT:</strong> 使用后端数据库默认的隔离级别，Mysql 默认采 用的 REPEATABLE_READ隔离级别 Oracle 默认采用的 READ_COMMITTED隔离级别. </li>
<li><strong>TransactionDefinition.ISOLATION_READ_UNCOMMITTED:</strong> 最低的隔离级别，允许读取尚未 提交的数据变更，可能会导致脏读、幻读或不可重复读 </li>
<li><strong>TransactionDefinition.ISOLATION_READ_COMMITTED:</strong> 允许读取并发事务已经提交的数据， 可以阻止脏读，但是幻读或不可重复读仍有可能发生 </li>
<li><strong>TransactionDefinition.ISOLATION_REPEATABLE_READ:</strong> 对同一字段的多次读取结果都是一致 的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生。 </li>
<li><strong>TransactionDefinition.ISOLATION_SERIALIZABLE:</strong> 最高的隔离级别，完全服从ACID的隔离级 别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止 脏读、不可重复读以及幻读。但是这将严重影响程序的性能。通常情况下也不会用到该级别。 </li>
</ul>
<h3 id="3-4-事务的传播行为"><a href="#3-4-事务的传播行为" class="headerlink" title="3.4 事务的传播行为"></a>3.4 事务的传播行为</h3><p>事务的传播行为，即如果有多个事务进行嵌套运行，子事务是否要和大事务公用一个事务。 当事务方法被另一个事务方法调用时，必须指定事务应该如何传播。 </p>
<p><strong>支持当前事务的情况：</strong> </p>
<p><strong>TransactionDefinition.PROPAGATION_REQUIRED：</strong> 如果当前存在事务，则加入该事务；如 果当前没有事务，则创建一个新的事务。</p>
<p><strong>TransactionDefinition.PROPAGATION_SUPPORTS：</strong> 如果当前存在事务，则加入该事务；如 果当前没有事务，则以非事务的方式继续运行。 </p>
<p><strong>TransactionDefinition.PROPAGATION_MANDATORY：</strong> 如果当前存在事务，则加入该事务； 如果当前没有事务，则抛出异常。（mandatory：强制性） </p>
<p><strong>不支持当前事务的情况：</strong> </p>
<p><strong>TransactionDefinition.PROPAGATION_REQUIRES_NEW：</strong> 当前事务总是创建一个新的事务， 如果当前存在事务，则把当前事务挂起。 </p>
<p><strong>TransactionDefinition.PROPAGATION_NOT_SUPPORTED：</strong> 以非事务方式运行，如果当前存 在事务，则把当前事务挂起。 </p>
<p><strong>TransactionDefinition.PROPAGATION_NEVER：</strong> 以非事务方式运行，如果当前存在事务，则 抛出异常。 </p>
<p><strong>其他情况：</strong> </p>
<p><strong>TransactionDefinition.PROPAGATION_NESTED：</strong> 如果当前存在事务，则创建一个事务作为当 前事务的嵌套事务来运行；如果当前没有事务，则该取值等价于 TransactionDefinition.PROPAGATION_REQUIRED。 </p>
<h3 id="3-5-案例"><a href="#3-5-案例" class="headerlink" title="3.5 案例"></a>3.5 案例</h3><p>REQUIRED：将之前事务用的connection传递给这个方法使用 </p>
<p>REQUIRES_NEW：这个方法直接使用新的connection </p>
<p>在BookDao类中再定义一个修改图书价格的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改图书价格</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePrice</span><span class="params">(String isbn,Integer price)</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">&quot;UPDATE book SET price=? where isbn =?&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>.jdbcTemplate.update(sql,price,isbn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>BookService类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//改价格方法</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePrice</span><span class="params">(String isbn,Integer price)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.bookDao.updatePrice(isbn, price);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建一个MulService类，其中有一个声明了事务的方法，同时调用结账方法和修改价格的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MulService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mulTx</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//结账</span></span><br><span class="line">        <span class="keyword">this</span>.bookService.checkOut(<span class="string">&quot;Tom&quot;</span>, <span class="string">&quot;ISBN-001&quot;</span>);</span><br><span class="line">        <span class="comment">//修改价格</span></span><br><span class="line">        <span class="keyword">this</span>.bookService.updatePrice(<span class="string">&quot;ISBN-002&quot;</span>, <span class="number">998</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="01-情况一"><a href="#01-情况一" class="headerlink" title="01 情况一"></a>01 情况一</h4><p>checkOut()方法和updatePrice()方法默认传播行为是REQUIRED，因为mulTx()方法存在事务，所以就加入它，所以如果一个方法崩了，<strong>则整体都会回滚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//结账 REQUIRED</span></span><br><span class="line"><span class="keyword">this</span>.bookService.checkOut(<span class="string">&quot;Tom&quot;</span>, <span class="string">&quot;ISBN-001&quot;</span>);</span><br><span class="line"><span class="comment">//修改价格 REQUIRED</span></span><br><span class="line"><span class="keyword">this</span>.bookService.updatePrice(<span class="string">&quot;ISBN-002&quot;</span>, <span class="number">998</span>)</span><br></pre></td></tr></table></figure>

<p>大家都在一车上，一个翻车全翻车。</p>
<h4 id="02-情况二"><a href="#02-情况二" class="headerlink" title="02 情况二"></a>02 情况二</h4><p>checkOut()方法传播行为设置为REQUIRES_NEW，即自己去开个新事务，在updatePrice()方法中引入异常。 </p>
<p>相当于第一个方法开了新车，第二个方法跟主方法在一车上，翻车了并不影响第一个方法，因此结账执行完成了，修改价格会回滚。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//结账 REQUIRES_NEW</span></span><br><span class="line"><span class="keyword">this</span>.bookService.checkOut(<span class="string">&quot;Tom&quot;</span>, <span class="string">&quot;ISBN-001&quot;</span>);</span><br><span class="line"><span class="comment">//修改价格 REQUIRED</span></span><br><span class="line"><span class="keyword">this</span>.bookService.updatePrice(<span class="string">&quot;ISBN-002&quot;</span>, <span class="number">998</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-配置文件实现声明式事务"><a href="#4-配置文件实现声明式事务" class="headerlink" title="4. 配置文件实现声明式事务"></a>4. 配置文件实现声明式事务</h2><p>aop:config ：告诉Spring哪些方法是事务方法：事务切面按照外面的切入点表达式去切入事务方法 </p>
<p>tx:advice ：配置事务建议，切入上面的切入点</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xiao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入数据库配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据库连接信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册jdbcTemplate，传入一个数据源即可--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理器(切面)，DataSourceTransactionManager--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--要控制哪个数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--结合AOP实现事务的织入--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务通知--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置事务属性，传播特性、超时时间等--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--指明哪些方法是事务方法--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务切入，告诉Spring哪些方法是事务方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切入点，com.xiao.service包下的所有类的所有方法，只是说事务管理器要切入这些</span></span><br><span class="line"><span class="comment">方法--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;myPoint&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xiao.service.*.*</span></span></span><br><span class="line"><span class="string"><span class="tag">                                               (..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--事务建议，让事务管理器切面来切入这个切入点表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPoint&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/java/" rel="tag"># java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/08/25/springMVC/" rel="prev" title="springMVC">
                springMVC <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/18cc395b668d48888eaca3a0cceec50a_th.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/icecfish" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#IOC%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%E3%80%81DI%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="nav-number">1.</span> <span class="nav-text">IOC控制反转、DI依赖注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Spring%E6%A6%82%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">1. Spring概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-HelloWorld%E6%A1%88%E4%BE%8B"><span class="nav-number">1.2.</span> <span class="nav-text">2.HelloWorld案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1IOC%E5%92%8CDI"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1IOC和DI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2入门案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%A0%B9%E6%8D%AEbean%E7%B1%BB%E5%9E%8B%E8%8E%B7%E5%8F%96bean%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3 根据bean类型获取bean实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%B1%9E%E6%80%A7%E7%9A%84%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F"><span class="nav-number">1.3.</span> <span class="nav-text">3.属性的注入方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-setter%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1 setter注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E9%80%9A%E8%BF%87%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2 通过构造器注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-p%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3 p名称空间注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-c%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E6%B3%A8%E5%85%A5"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4 c命名空间注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%B3%A8%E5%85%A5%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="nav-number">1.4.</span> <span class="nav-text">4.注入不同类型的属性值</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E6%B3%A8%E5%85%A5%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E5%80%BC"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1 注入基本类型值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E6%B3%A8%E5%85%A5null"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2 注入null</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E6%B3%A8%E5%85%A5bean"><span class="nav-number">1.4.3.</span> <span class="nav-text">4.3 注入bean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B%E8%B5%8B%E5%80%BC"><span class="nav-number">1.4.4.</span> <span class="nav-text">4.3 集合类型赋值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#01-%E6%95%B0%E7%BB%84"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">01 数组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#02-List"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">02 List</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#03-Map"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">03 Map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#05-util%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4"><span class="nav-number">1.4.4.4.</span> <span class="nav-text">05 util名称空间</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E7%BA%A7%E8%81%94%E5%B1%9E%E6%80%A7%E8%B5%8B%E5%80%BC"><span class="nav-number">1.4.5.</span> <span class="nav-text">4.4 级联属性赋值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-%E7%BB%A7%E6%89%BF%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E9%87%8D%E7%94%A8"><span class="nav-number">1.4.6.</span> <span class="nav-text">4.5 继承实现配置信息重用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-bean%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%A7%E8%B4%A8"><span class="nav-number">1.5.</span> <span class="nav-text">5.bean的一些性质</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-bean%E4%B9%8B%E9%97%B4%E4%BE%9D%E8%B5%96"><span class="nav-number">1.5.1.</span> <span class="nav-text">5.1 bean之间依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9Fscope"><span class="nav-number">1.5.2.</span> <span class="nav-text">5.2 bean的作用域scope</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E9%9D%99%E6%80%81%E5%B7%A5%E5%8E%82%E4%B8%8E%E5%AE%9E%E4%BE%8B%E5%B7%A5%E5%8E%82"><span class="nav-number">1.5.3.</span> <span class="nav-text">5.3 静态工厂与实例工厂</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%8E%82"><span class="nav-number">1.5.4.</span> <span class="nav-text">5.4 自定义工厂</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%96%B9%E6%B3%95"><span class="nav-number">1.5.5.</span> <span class="nav-text">5.5 bean的生命周期方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-bean%E7%9A%84%E5%90%8E%E7%BD%AE%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">1.5.6.</span> <span class="nav-text">5.6 bean的后置处理器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-bean%E7%9A%84%E8%A3%85%E9%85%8D"><span class="nav-number">1.6.</span> <span class="nav-text">6.bean的装配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-Spring%E7%AE%A1%E7%90%86%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">1.6.1.</span> <span class="nav-text">6.1 Spring管理连接池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.6.2.</span> <span class="nav-text">6.2 引入外部配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-%E5%9F%BA%E4%BA%8EXML%E7%9A%84%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="nav-number">1.6.3.</span> <span class="nav-text">6.3 基于XML的自动装配</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="nav-number">1.7.</span> <span class="nav-text">7.注解开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-context%E6%89%AB%E6%8F%8F%E5%8C%85%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">1.7.1.</span> <span class="nav-text">7.2 context扫描包的配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-Autowired%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="nav-number">1.7.2.</span> <span class="nav-text">7.3 Autowired自动装配</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#01-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">01 基本使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#02-Autowired%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">02 Autowired的执行流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#03-%E6%B3%A8%E8%A7%A3%E5%8A%A0%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%8A"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">03 注解加在方法上</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-Spring%E7%9A%84%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="nav-number">1.7.3.</span> <span class="nav-text">7.4 Spring的单元测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E3%80%81AOP"><span class="nav-number">2.</span> <span class="nav-text">动态代理、AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.1.</span> <span class="nav-text">1. 代理模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">2.1.1.</span> <span class="nav-text">1.1 静态代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">2.1.2.</span> <span class="nav-text">1.2 动态代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD"><span class="nav-number">2.1.3.</span> <span class="nav-text">1.3 动态代理实现日志功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-aop"><span class="nav-number">2.2.</span> <span class="nav-text">2.aop</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%87%A0%E4%B8%AA%E4%B8%93%E4%B8%9A%E6%9C%AF%E8%AF%AD"><span class="nav-number">2.2.1.</span> <span class="nav-text">2.1 几个专业术语</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.2 注解实现步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%87%A0%E4%B8%AA%E7%BB%86%E8%8A%82"><span class="nav-number">2.2.3.</span> <span class="nav-text">2.3 注解实现的几个细节</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#01-%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BB%B6"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">01 获取组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#02-cglib"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">02 cglib</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#03-%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%86%99%E6%B3%95"><span class="nav-number">2.2.3.3.</span> <span class="nav-text">03 切入点表达式的写法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#04-%E9%80%9A%E7%9F%A5%E6%96%B9%E6%B3%95%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-number">2.2.3.4.</span> <span class="nav-text">04 通知方法的执行顺序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#05-%E6%8B%BF%E5%88%B0%E7%9B%AE%E6%A0%87%E6%96%B9%E6%B3%95%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="nav-number">2.2.3.5.</span> <span class="nav-text">05 拿到目标方法的详细信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#06-%E6%8A%BD%E5%8F%96%E5%8F%AF%E9%87%8D%E7%94%A8%E7%9A%84%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">2.2.3.6.</span> <span class="nav-text">06 抽取可重用的切入点表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#07-%E7%8E%AF%E7%BB%95%E9%80%9A%E7%9F%A5"><span class="nav-number">2.2.3.7.</span> <span class="nav-text">07 环绕通知</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#08-%E5%A4%9A%E5%88%87%E9%9D%A2%E6%83%85%E5%86%B5"><span class="nav-number">2.2.3.8.</span> <span class="nav-text">08 多切面情况</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-4-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.2.3.8.1.</span> <span class="nav-text">2.4 配置文件实现</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="nav-number">3.</span> <span class="nav-text">声明式事务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">3.1.</span> <span class="nav-text">1. 环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8E%AF%E5%A2%83"><span class="nav-number">3.1.1.</span> <span class="nav-text">1.1 数据库环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%87%8F%E4%BD%99%E9%A2%9D%E3%80%81%E5%87%8F%E5%BA%93%E5%AD%98%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">3.1.2.</span> <span class="nav-text">1.2 减余额、减库存的方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="nav-number">3.2.</span> <span class="nav-text">2. 声明式事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E4%BA%8B%E5%8A%A1%E7%9A%84ACID%E5%8E%9F%E5%88%99"><span class="nav-number">3.2.1.</span> <span class="nav-text">2.1 事务的ACID原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E9%85%8D%E7%BD%AE"><span class="nav-number">3.2.2.</span> <span class="nav-text">2.2 声明式事务配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E4%BA%8B%E5%8A%A1%E7%BB%86%E8%8A%82"><span class="nav-number">3.3.</span> <span class="nav-text">3. 事务细节</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E8%B6%85%E6%97%B6-%E5%8F%AA%E8%AF%BB"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.1 超时&#x2F;只读</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-rollbackFor-noRollbackFor"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.2 rollbackFor&#x2F;noRollbackFor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-number">3.3.3.</span> <span class="nav-text">3.3 事务的隔离级别</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#01-%E4%BA%8B%E5%8A%A1%E5%B9%B6%E5%8F%91%E8%BF%90%E8%A1%8C%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">3.3.3.1.</span> <span class="nav-text">01 事务并发运行带来的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#02-SQL%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-number">3.3.3.2.</span> <span class="nav-text">02 SQL的隔离级别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#03-Spring%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-number">3.3.3.3.</span> <span class="nav-text">03 Spring事务的隔离级别</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA"><span class="nav-number">3.3.4.</span> <span class="nav-text">3.4 事务的传播行为</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E6%A1%88%E4%BE%8B"><span class="nav-number">3.3.5.</span> <span class="nav-text">3.5 案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#01-%E6%83%85%E5%86%B5%E4%B8%80"><span class="nav-number">3.3.5.1.</span> <span class="nav-text">01 情况一</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#02-%E6%83%85%E5%86%B5%E4%BA%8C"><span class="nav-number">3.3.5.2.</span> <span class="nav-text">02 情况二</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="nav-number">3.4.</span> <span class="nav-text">4. 配置文件实现声明式事务</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zcb</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
